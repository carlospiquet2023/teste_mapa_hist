<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Gestão de Eventos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }
        
        .animated-bg::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveBackground 20s linear infinite;
        }
        
        @keyframes moveBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Input Focus Effect */
        .input-group input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        }
        
        /* Button Ripple Effect */
        .btn-login {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-login::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-login:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-login:active {
            transform: scale(0.95);
        }
        
        /* Shake Animation for Error */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        .shake {
            animation: shake 0.6s;
        }
        
        /* Lock Icon Animation */
        @keyframes lockBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .lock-icon {
            animation: lockBounce 2s ease-in-out infinite;
        }
        
        /* Alert Styles */
        .alert {
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Login Container -->
    <div class="relative z-10 w-full max-w-md px-4">
        <div class="glass rounded-3xl p-8 shadow-2xl animate__animated animate__fadeInUp">
            
            <!-- Logo/Icon -->
            <div class="text-center mb-8">
                <div class="inline-block bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-2xl mb-4 lock-icon">
                    <i class="fas fa-lock text-white text-5xl"></i>
                </div>
                <h1 class="text-3xl font-black text-gray-800 mb-2">Sistema de Gestão</h1>
                <p class="text-gray-600 font-medium">Acesso Restrito - Administradores</p>
            </div>
            
            <!-- Alert Container -->
            <div id="alert-container"></div>
            
            <!-- Login Form -->
            <form id="login-form" class="space-y-6">
                <!-- Username -->
                <div class="input-group">
                    <label for="username" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-user mr-2 text-purple-600"></i>Usuário
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username"
                        required
                        autocomplete="username"
                        placeholder="Digite seu usuário"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-all duration-300 font-medium"
                    />
                </div>
                
                <!-- Password -->
                <div class="input-group">
                    <label for="password" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-key mr-2 text-purple-600"></i>Senha
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            name="password"
                            required
                            autocomplete="current-password"
                            placeholder="Digite sua senha"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-all duration-300 font-medium pr-12"
                        />
                        <button 
                            type="button" 
                            id="toggle-password"
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-purple-600 transition-colors"
                        >
                            <i class="fas fa-eye" id="eye-icon"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button 
                    type="submit" 
                    class="btn-login w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl"
                >
                    <i class="fas fa-sign-in-alt mr-2"></i>Entrar no Sistema
                </button>
            </form>
            
            <!-- Footer Info -->
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="text-center space-y-2">
                    <p class="text-xs text-gray-500">
                        <i class="fas fa-shield-alt mr-1"></i>
                        Sistema protegido com autenticação
                    </p>
                    <p class="text-xs text-gray-400">
                        © 2025 Carlos Antonio de Oliveira Piquet
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <div class="text-center mt-6">
            <a 
                href="../index.html" 
                class="inline-flex items-center gap-2 text-white font-semibold hover:text-purple-200 transition-colors"
            >
                <i class="fas fa-arrow-left"></i>
                Voltar ao Mapa Histórico
            </a>
        </div>
    </div>

    <script>
        'use strict';

        // ========================================
        // SISTEMA DE AUTENTICAÇÃO
        // ========================================

        // Credenciais (em produção, usar backend seguro)
        const CREDENTIALS = {
            username: 'mapahistorico',
            password: '!Senha123'
        };

        const SESSION_KEY = 'sistema_eventos_authenticated';

        // Elementos DOM
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const eyeIcon = document.getElementById('eye-icon');
        const alertContainer = document.getElementById('alert-container');

        // Verificar se já está autenticado (agora usa sessionStorage)
        function checkExistingSession() {
            const isAuthenticated = sessionStorage.getItem(SESSION_KEY);

            if (isAuthenticated === 'true') {
                // Sessão válida, redirecionar imediatamente
                console.log('Sessão válida encontrada, redirecionando...');
                showAlert('Sessão ativa encontrada! Redirecionando...', 'success');
                setTimeout(() => {
                    window.location.href = 'eventos.html';
                }, 1000);
                return true;
            }
            return false;
        }

        // Mostrar alerta
        function showAlert(message, type = 'error') {
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'} text-xl"></i>
                    <span>${message}</span>
                </div>
            `;

            // Remover alerta após 5 segundos
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Limpar sessão
        function clearSession() {
            sessionStorage.removeItem(SESSION_KEY);
        }

        // Toggle password visibility
        togglePasswordBtn.addEventListener('click', () => {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            
            if (type === 'password') {
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            } else {
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            }
        });

        // Handle form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const username = usernameInput.value.trim();
            const password = passwordInput.value;

            // Validar credenciais
            if (username === CREDENTIALS.username && password === CREDENTIALS.password) {
                // Autenticação bem-sucedida
                showAlert('Login realizado com sucesso! Redirecionando...', 'success');

                // Criar sessão que expira ao fechar o navegador (sessionStorage)
                try {
                    sessionStorage.setItem(SESSION_KEY, 'true');
                    
                    // Verificar se foi salvo corretamente
                    const saved = sessionStorage.getItem(SESSION_KEY);
                    console.log('Sessão criada (expira ao fechar navegador):', { saved });
                    
                    if (saved !== 'true') {
                        throw new Error('Falha ao salvar sessão');
                    }
                } catch (error) {
                    console.error('Erro ao criar sessão:', error);
                    showAlert('Erro ao salvar sessão. Tente novamente.', 'error');
                    return;
                }

                // Redirecionar após 1.5 segundos
                setTimeout(() => {
                    window.location.href = 'eventos.html';
                }, 1500);
            } else {
                // Autenticação falhou
                showAlert('Usuário ou senha incorretos!', 'error');
                
                // Shake animation
                loginForm.classList.add('shake');
                setTimeout(() => {
                    loginForm.classList.remove('shake');
                }, 600);

                // Limpar campos
                passwordInput.value = '';
                passwordInput.focus();
            }
        });

        // Focus no campo de usuário ao carregar
        window.addEventListener('DOMContentLoaded', () => {
            checkExistingSession();
            usernameInput.focus();
        });

        // Prevenir acesso direto ao eventos.html
        window.addEventListener('storage', (e) => {
            if (e.key === SESSION_KEY && e.newValue === null) {
                // Sessão removida em outra aba
                clearSession();
            }
        });
    </script>
</body>
</html>
